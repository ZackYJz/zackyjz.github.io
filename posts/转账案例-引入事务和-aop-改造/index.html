<!DOCTYPE html>
<html><head>
<title>ËΩ¨Ë¥¶Ê°à‰æã-ÂºïÂÖ•‰∫ãÂä°ÂíåAOPÊîπÈÄ†</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="ÈÄöËøáÁÆÄÂçïÁöÑËΩ¨Ë¥¶‰∏öÂä°Ê°à‰æãÔºå‰ªéÊúÄÂàùÊó†‰∫ãÂä°ÁöÑÂü∫Á°ÄÂäüËÉΩÁâàÊú¨ÔºåÈÄöËøá‰ª£ÁêÜÂíåAOPÈÄêÊ≠•ËøõË°åÊîπÈÄ†Âíå‰ºòÂåñ">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">











<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://logseq.oss-cn-chengdu.aliyuncs.com/noteImg/202203191023457.png">



<link rel="stylesheet" href="https://blog.wvuuvw.xyz/scss/journal.min.75229c530b3f6aa895d7c569612d6ca3e5bef57767db1972945785a7a418f179.css" integrity="sha256-dSKcUws/aqiV18VpYS1so&#43;W&#43;9Xdn2xlylFeFp6QY8Xk=" media="screen">



<link rel="stylesheet" href="https://blog.wvuuvw.xyz/scss/dark-mode.min.c4db381abcd93bb0867e0779702d9c25d111348a10647020dbc43f1f0cb14cbb.css" integrity="sha256-xNs4GrzZO7CGfgd5cC2cJdERNIoQZHAg28Q/HwyxTLs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Noto+Sans+SC");
</script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Source+Code+Pro|Fira+Mono|Material+Icons");
</script>







  <script src="/js/toc.js"></script>














</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://blog.wvuuvw.xyz/">
    
        <div class="nav-title">
            ZackYJ&#39;s Blog
        </div>
        
        <div class="nav-subtitle">
            Stay hungry , Stay foolish
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                üìë ÊñáÁ´†
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                üóÑ ÂàÜÁ±ª
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                üè∑ Ê†áÁ≠æ 
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/project/project">
                üìá È°πÁõÆ
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about/aboutme">
                üë®‚Äçüíª ÂÖ≥‰∫é
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Powered by <a href="https://github.com/gohugoio/hugo">hugo</a>
<br>

&copy;
	
	2022 ZackYJ&#39;s Blog
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ÁõÆÂΩï -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%9f%ba%e7%a1%80%e5%8a%9f%e8%83%bd" onclick="onNavClick(`#Âü∫Á°ÄÂäüËÉΩ-nav`)" id="Âü∫Á°ÄÂäüËÉΩ-nav">
									Âü∫Á°ÄÂäüËÉΩ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bc%a0%e7%bb%9f%e7%9a%84%e4%ba%8b%e5%8a%a1%e6%93%8d%e4%bd%9c" onclick="onNavClick(`#‰º†ÁªüÁöÑ‰∫ãÂä°Êìç‰Ωú-nav`)" id="‰º†ÁªüÁöÑ‰∫ãÂä°Êìç‰Ωú-nav">
									‰º†ÁªüÁöÑ‰∫ãÂä°Êìç‰Ωú
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%bf%9e%e6%8e%a5%e7%ba%bf%e7%a8%8b%e7%bb%91%e5%ae%9a%e5%b7%a5%e5%85%b7%e7%b1%bb" onclick="onNavClick(`#ËøûÊé•Á∫øÁ®ãÁªëÂÆöÂ∑•ÂÖ∑Á±ª-nav`)" id="ËøûÊé•Á∫øÁ®ãÁªëÂÆöÂ∑•ÂÖ∑Á±ª-nav">
									ËøûÊé•Á∫øÁ®ãÁªëÂÆöÂ∑•ÂÖ∑Á±ª
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%ba%8b%e5%8a%a1%e7%ae%a1%e7%90%86%e5%99%a8%e5%b7%a5%e5%85%b7%e7%b1%bb" onclick="onNavClick(`#‰∫ãÂä°ÁÆ°ÁêÜÂô®Â∑•ÂÖ∑Á±ª-nav`)" id="‰∫ãÂä°ÁÆ°ÁêÜÂô®Â∑•ÂÖ∑Á±ª-nav">
									‰∫ãÂä°ÁÆ°ÁêÜÂô®Â∑•ÂÖ∑Á±ª
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%94%b9%e9%80%a0-servie-%e5%92%8c-dao" onclick="onNavClick(`#ÊîπÈÄ†-servie-Âíå-dao-nav`)" id="ÊîπÈÄ†-servie-Âíå-dao-nav">
									ÊîπÈÄ† Servie Âíå Dao
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#proxy-%e5%8a%a8%e6%80%81%e4%bb%a3%e7%90%86%e4%bc%98%e5%8c%96" onclick="onNavClick(`#proxy-Âä®ÊÄÅ‰ª£ÁêÜ‰ºòÂåñ-nav`)" id="proxy-Âä®ÊÄÅ‰ª£ÁêÜ‰ºòÂåñ-nav">
									Proxy Âä®ÊÄÅ‰ª£ÁêÜ‰ºòÂåñ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#jdk-%e5%8a%a8%e6%80%81%e4%bb%a3%e7%90%86" onclick="onNavClick(`#jdk-Âä®ÊÄÅ‰ª£ÁêÜ-nav`)" id="jdk-Âä®ÊÄÅ‰ª£ÁêÜ-nav">
									JDK Âä®ÊÄÅ‰ª£ÁêÜ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#cglib-%e5%8a%a8%e6%80%81%e4%bb%a3%e7%90%86" onclick="onNavClick(`#cglib-Âä®ÊÄÅ‰ª£ÁêÜ-nav`)" id="cglib-Âä®ÊÄÅ‰ª£ÁêÜ-nav">
									CGLIB Âä®ÊÄÅ‰ª£ÁêÜ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#aop-%e4%bc%98%e5%8c%96" onclick="onNavClick(`#aop-‰ºòÂåñ-nav`)" id="aop-‰ºòÂåñ-nav">
									AOP ‰ºòÂåñ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    üìë ÊñáÁ´†
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    üóÑ ÂàÜÁ±ª
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    üè∑ Ê†áÁ≠æ 
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/project/project">
                    üìá È°πÁõÆ
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about/aboutme">
                    üë®‚Äçüíª ÂÖ≥‰∫é
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ÁõÆÂΩï -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%9f%ba%e7%a1%80%e5%8a%9f%e8%83%bd" onclick="onNavClick(`#Âü∫Á°ÄÂäüËÉΩ-nav`)" id="Âü∫Á°ÄÂäüËÉΩ-nav">
									Âü∫Á°ÄÂäüËÉΩ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bc%a0%e7%bb%9f%e7%9a%84%e4%ba%8b%e5%8a%a1%e6%93%8d%e4%bd%9c" onclick="onNavClick(`#‰º†ÁªüÁöÑ‰∫ãÂä°Êìç‰Ωú-nav`)" id="‰º†ÁªüÁöÑ‰∫ãÂä°Êìç‰Ωú-nav">
									‰º†ÁªüÁöÑ‰∫ãÂä°Êìç‰Ωú
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%bf%9e%e6%8e%a5%e7%ba%bf%e7%a8%8b%e7%bb%91%e5%ae%9a%e5%b7%a5%e5%85%b7%e7%b1%bb" onclick="onNavClick(`#ËøûÊé•Á∫øÁ®ãÁªëÂÆöÂ∑•ÂÖ∑Á±ª-nav`)" id="ËøûÊé•Á∫øÁ®ãÁªëÂÆöÂ∑•ÂÖ∑Á±ª-nav">
									ËøûÊé•Á∫øÁ®ãÁªëÂÆöÂ∑•ÂÖ∑Á±ª
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%ba%8b%e5%8a%a1%e7%ae%a1%e7%90%86%e5%99%a8%e5%b7%a5%e5%85%b7%e7%b1%bb" onclick="onNavClick(`#‰∫ãÂä°ÁÆ°ÁêÜÂô®Â∑•ÂÖ∑Á±ª-nav`)" id="‰∫ãÂä°ÁÆ°ÁêÜÂô®Â∑•ÂÖ∑Á±ª-nav">
									‰∫ãÂä°ÁÆ°ÁêÜÂô®Â∑•ÂÖ∑Á±ª
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%94%b9%e9%80%a0-servie-%e5%92%8c-dao" onclick="onNavClick(`#ÊîπÈÄ†-servie-Âíå-dao-nav`)" id="ÊîπÈÄ†-servie-Âíå-dao-nav">
									ÊîπÈÄ† Servie Âíå Dao
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#proxy-%e5%8a%a8%e6%80%81%e4%bb%a3%e7%90%86%e4%bc%98%e5%8c%96" onclick="onNavClick(`#proxy-Âä®ÊÄÅ‰ª£ÁêÜ‰ºòÂåñ-nav`)" id="proxy-Âä®ÊÄÅ‰ª£ÁêÜ‰ºòÂåñ-nav">
									Proxy Âä®ÊÄÅ‰ª£ÁêÜ‰ºòÂåñ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#jdk-%e5%8a%a8%e6%80%81%e4%bb%a3%e7%90%86" onclick="onNavClick(`#jdk-Âä®ÊÄÅ‰ª£ÁêÜ-nav`)" id="jdk-Âä®ÊÄÅ‰ª£ÁêÜ-nav">
									JDK Âä®ÊÄÅ‰ª£ÁêÜ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#cglib-%e5%8a%a8%e6%80%81%e4%bb%a3%e7%90%86" onclick="onNavClick(`#cglib-Âä®ÊÄÅ‰ª£ÁêÜ-nav`)" id="cglib-Âä®ÊÄÅ‰ª£ÁêÜ-nav">
									CGLIB Âä®ÊÄÅ‰ª£ÁêÜ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#aop-%e4%bc%98%e5%8c%96" onclick="onNavClick(`#aop-‰ºòÂåñ-nav`)" id="aop-‰ºòÂåñ-nav">
									AOP ‰ºòÂåñ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://blog.wvuuvw.xyz/">
            ZackYJ&#39;s Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://blog.wvuuvw.xyz/">
        <div class="single-column-header-title">ZackYJ&#39;s Blog</div>
        
        <div class="single-column-header-subtitle">Stay hungry , Stay foolish</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://images.unsplash.com/photo-1616077167555-51f6bc516dfa?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=2071&amp;q=80')"
                    
                
            >
                <div class="post-title">
                    ËΩ¨Ë¥¶Ê°à‰æã-ÂºïÂÖ•‰∫ãÂä°ÂíåAOPÊîπÈÄ†
                    
                    <div class="post-subtitle">
                        ÈÄöËøáÁÆÄÂçïÁöÑËΩ¨Ë¥¶‰∏öÂä°Ê°à‰æãÔºå‰ªéÊúÄÂàùÊó†‰∫ãÂä°ÁöÑÂü∫Á°ÄÂäüËÉΩÁâàÊú¨ÔºåÈÄöËøá‰ª£ÁêÜÂíåAOPÈÄêÊ≠•ËøõË°åÊîπÈÄ†Âíå‰ºòÂåñ
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2021-01-03 08:31
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/java">Java</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/spring">spring</a>
                                &nbsp;
                            
                                <a href="/tags/%E4%BA%8B%E5%8A%A1">‰∫ãÂä°</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h3 id="Âü∫Á°ÄÂäüËÉΩ">Âü∫Á°ÄÂäüËÉΩ</h3>
<hr>
<p>spring Êï¥Âêà DBUtils ÔºåÂÆûÁé∞ÁÆÄÂçïÁöÑÁî®Êà∑ËΩ¨Ë¥¶‰∏öÂä°</p>
<ul>
<li>
<p>Account ÂÆû‰ΩìÁ±ª</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Account</span> <span style="color:#ff79c6">{</span>
  <span style="color:#8be9fd;font-style:italic">private</span> Integer id<span style="color:#ff79c6">;</span>
  <span style="color:#8be9fd;font-style:italic">private</span> String name<span style="color:#ff79c6">;</span>
  <span style="color:#8be9fd;font-style:italic">private</span> Double money<span style="color:#ff79c6">;</span>
  <span style="color:#6272a4">// setter getter....
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">}</span>
</code></pre></div></li>
<li>
<p>AccountDao Êé•Âè£ÂíåÂÆûÁé∞Á±ª</p>
<ul>
<li>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">AccountDao</span> <span style="color:#ff79c6">{</span>
  <span style="color:#6272a4">// ËΩ¨Âá∫Êìç‰Ωú
</span><span style="color:#6272a4"></span>  <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">out</span><span style="color:#ff79c6">(</span>String outUser<span style="color:#ff79c6">,</span> Double money<span style="color:#ff79c6">);</span>
  <span style="color:#6272a4">// ËΩ¨ÂÖ•Êìç‰Ωú
</span><span style="color:#6272a4"></span>  <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">in</span><span style="color:#ff79c6">(</span>String inUser<span style="color:#ff79c6">,</span> Double money<span style="color:#ff79c6">);</span>
<span style="color:#ff79c6">}</span>
</code></pre></div></li>
<li>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Repository
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">AccountDaoImpl</span> <span style="color:#8be9fd;font-style:italic">implements</span> AccountDao <span style="color:#ff79c6">{</span>
    @Autowired
    <span style="color:#8be9fd;font-style:italic">private</span> QueryRunner queryRunner<span style="color:#ff79c6">;</span>
    @Override
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">out</span><span style="color:#ff79c6">(</span>String outUser<span style="color:#ff79c6">,</span> Double money<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
      <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
          queryRunner<span style="color:#ff79c6">.</span><span style="color:#50fa7b">update</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;update account set money=money-? where name=?&#34;</span><span style="color:#ff79c6">,</span>
          money<span style="color:#ff79c6">,</span> outUser<span style="color:#ff79c6">);</span>
      <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>SQLException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
          e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
      <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">}</span>

    @Override
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">in</span><span style="color:#ff79c6">(</span>String inUser<span style="color:#ff79c6">,</span> Double money<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
      <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
        queryRunner<span style="color:#ff79c6">.</span><span style="color:#50fa7b">update</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;update account set money=money+? where name=?&#34;</span><span style="color:#ff79c6">,</span>
        money<span style="color:#ff79c6">,</span> inUser<span style="color:#ff79c6">);</span>
      <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>SQLException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
      <span style="color:#ff79c6">}</span>
		<span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p>AccountService Êé•Âè£ÂíåÂÆûÁé∞Á±ª</p>
<ul>
<li>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">AccountService</span> <span style="color:#ff79c6">{</span>
      <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">transfer</span><span style="color:#ff79c6">(</span>String outUser<span style="color:#ff79c6">,</span> String inUser<span style="color:#ff79c6">,</span> Double money<span style="color:#ff79c6">);</span>
  <span style="color:#ff79c6">}</span>
</code></pre></div></li>
<li>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Service
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">AccountServiceImpl</span> <span style="color:#8be9fd;font-style:italic">implements</span> AccountService <span style="color:#ff79c6">{</span>
    @Autowired
    <span style="color:#8be9fd;font-style:italic">private</span> AccountDao accountDao<span style="color:#ff79c6">;</span>

    @Override
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">transfer</span><span style="color:#ff79c6">(</span>String outUser<span style="color:#ff79c6">,</span> String inUser<span style="color:#ff79c6">,</span> Double money<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
      accountDao<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">(</span>outUser<span style="color:#ff79c6">,</span> money<span style="color:#ff79c6">);</span>
      accountDao<span style="color:#ff79c6">.</span><span style="color:#50fa7b">in</span><span style="color:#ff79c6">(</span>inUser<span style="color:#ff79c6">,</span> money<span style="color:#ff79c6">);</span>
		<span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<blockquote>
<p>Ëá≥Ê≠§ÂÆûÁé∞‰∫ÜÂü∫Êú¨ÁöÑ‰∏öÂä°ËΩ¨Ë¥¶ÈÄªËæëÔºå‰ΩÜ‰ª•‰∏ä‰ª£Á†Å‰∏≠Ôºå‰º†Âá∫ÂíåËΩ¨ÂÖ•Êìç‰ΩúÂú® Dao Â±ÇÂÆûÁé∞ÔºåÂàÜÂà´ÈÉΩÊòØÁã¨Á´ãÁöÑ‰∫ãÂä°ÔºåÂ¶ÇÊûúÂú®ËΩ¨Âá∫ÂêéÂèëÁîüÂºÇÂ∏∏ÔºåËΩ¨ÂÖ•Êìç‰Ωú‰ºöÂæó‰∏çÂà∞ÂéüÂ≠êÊÄßÁöÑ‰øùËØÅÔºåÂá∫Áé∞Êï∞ÊçÆ‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµ</p>
</blockquote>
<p>ÊîπËøõÔºöÊää‰∏öÂä°ÈÄªËæëÊéßÂà∂Âú®‰∏Ä‰∏™‰∫ãÂä°‰∏≠ÔºåÂ∞Ü‰∫ãÂä°Êå™Âà∞serviceÂ±Ç</p>
<h3 id="‰º†ÁªüÁöÑ‰∫ãÂä°Êìç‰Ωú">‰º†ÁªüÁöÑ‰∫ãÂä°Êìç‰Ωú</h3>
<hr>
<h4 id="ËøûÊé•Á∫øÁ®ãÁªëÂÆöÂ∑•ÂÖ∑Á±ª">ËøûÊé•Á∫øÁ®ãÁªëÂÆöÂ∑•ÂÖ∑Á±ª</h4>
<p>‰∏∫‰∫Ü‰øùËØÅÂú® Dao Â±ÇË∞ÉÁî® in,out ÊñπÊ≥ïÁöÑÊòØÂêå‰∏Ä‰∏™Á∫øÁ®ãÔºåÁºñÂÜô‰∏Ä‰∏™ËøûÊé•Â∑•ÂÖ∑Á±ªÔºå‰ªéÊï∞ÊçÆÂ∫ìËé∑ÂèñËøûÊé•ÂØπË±°ÔºåÂà©Áî® ThreadLocal  ÂÆûÁé∞ÂíåÁ∫øÁ®ãÁöÑÁªëÂÆö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">ConnectionUtils</span> <span style="color:#ff79c6">{</span>
    @Autowired
    <span style="color:#8be9fd;font-style:italic">private</span> DataSource dataSource<span style="color:#ff79c6">;</span>
    <span style="color:#8be9fd;font-style:italic">private</span> ThreadLocal<span style="color:#ff79c6">&lt;</span>Connection<span style="color:#ff79c6">&gt;</span> threadLocal <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> ThreadLocal<span style="color:#ff79c6">&lt;&gt;();</span>

    <span style="color:#6272a4">/*
</span><span style="color:#6272a4">        Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ã‰∏äÁªëÂÆöËøûÊé•ÔºöÂ¶ÇÊûúËé∑ÂèñÂà∞ÁöÑËøûÊé•‰∏∫Á©∫ÔºåÈÇ£‰πàÂ∞±Ë¶Å‰ªéÊï∞ÊçÆÊ∫ê‰∏≠Ëé∑ÂèñËøûÊé•ÔºåÂπ∂‰∏îÊîæÂà∞ThreadLocal‰∏≠ÔºàÁªëÂÆöÂà∞ÂΩìÂâçÁ∫øÁ®ãÔºâ
</span><span style="color:#6272a4">     */</span>
    <span style="color:#8be9fd;font-style:italic">public</span>  Connection <span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">(){</span>
        <span style="color:#6272a4">// 1. ÂÖà‰ªéThreadLocal‰∏äËé∑ÂèñËøûÊé•
</span><span style="color:#6272a4"></span>        Connection connection <span style="color:#ff79c6">=</span> threadLocal<span style="color:#ff79c6">.</span><span style="color:#50fa7b">get</span><span style="color:#ff79c6">();</span>

        <span style="color:#6272a4">// 2. Âà§Êñ≠ÂΩìÂâçÁ∫øÁ®ã‰∏≠ÊòØÂê¶ÊòØÊúâConnection
</span><span style="color:#6272a4"></span>        <span style="color:#ff79c6">if</span><span style="color:#ff79c6">(</span>connection <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">){</span>
            <span style="color:#6272a4">// 3. ‰ªéÊï∞ÊçÆÊ∫ê‰∏≠Ëé∑Âèñ‰∏Ä‰∏™ËøûÊé•ÔºåÂπ∂‰∏îÂ≠òÂÖ•ThreadLocal‰∏≠
</span><span style="color:#6272a4"></span>            <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
                <span style="color:#6272a4">// ‰∏ç‰∏∫null
</span><span style="color:#6272a4"></span>                connection <span style="color:#ff79c6">=</span> dataSource<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getConnection</span><span style="color:#ff79c6">();</span>

                threadLocal<span style="color:#ff79c6">.</span><span style="color:#50fa7b">set</span><span style="color:#ff79c6">(</span>connection<span style="color:#ff79c6">);</span>

            <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>SQLException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
                e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
            <span style="color:#ff79c6">}</span>
        <span style="color:#ff79c6">}</span>
        <span style="color:#ff79c6">return</span>  connection<span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
    <span style="color:#6272a4">/*
</span><span style="color:#6272a4">        Ëß£Èô§ÂΩìÂâçÁ∫øÁ®ãÁöÑËøûÊé•ÁªëÂÆö
</span><span style="color:#6272a4">     */</span>
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span>  <span style="color:#50fa7b">removeThreadConnection</span><span style="color:#ff79c6">(){</span>
        threadLocal<span style="color:#ff79c6">.</span><span style="color:#50fa7b">remove</span><span style="color:#ff79c6">();</span>
    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></div><h4 id="‰∫ãÂä°ÁÆ°ÁêÜÂô®Â∑•ÂÖ∑Á±ª">‰∫ãÂä°ÁÆ°ÁêÜÂô®Â∑•ÂÖ∑Á±ª</h4>
<p>Â∞ÅË£Ö‰∫ãÂä°Êìç‰ΩúÔºåÈÄöËøá‰∏äÈù¢ÁöÑÁ∫øÁ®ãÁªëÂÆöÂ∑•ÂÖ∑Á±ªËé∑Âèñ Connection</p>
<p>Âú®Ëøô‰∏™Â∑•ÂÖ∑Á±ª‰∏≠ÔºåËøõË°åÂºÄÂêØ‰∫ãÂä°„ÄÅÊèê‰∫§‰∫ãÂä°„ÄÅÂõûÊªö‰∫ãÂä°„ÄÅÈáäÊîæËµÑÊ∫êÁöÑÁªü‰∏ÄÊéßÂà∂</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Component<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;transactionManager&#34;</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">TransactionManager</span> <span style="color:#ff79c6">{</span>

    @Autowired
    <span style="color:#8be9fd;font-style:italic">private</span> ConnectionUtils connectionUtils<span style="color:#ff79c6">;</span>

    <span style="color:#6272a4">/*
</span><span style="color:#6272a4">      ÂºÄÂêØ‰∫ãÂä°
</span><span style="color:#6272a4">    */</span>
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">beginTransaction</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>

        <span style="color:#6272a4">// Ëé∑ÂèñconnectionÂØπË±°
</span><span style="color:#6272a4"></span>        Connection connection <span style="color:#ff79c6">=</span> connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
            <span style="color:#6272a4">// ÂºÄÂêØ‰∫Ü‰∏Ä‰∏™ÊâãÂä®‰∫ãÂä°
</span><span style="color:#6272a4"></span>            connection<span style="color:#ff79c6">.</span><span style="color:#50fa7b">setAutoCommit</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">false</span><span style="color:#ff79c6">);</span>
        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>SQLException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
            e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span>

    <span style="color:#ff79c6">}</span>

    <span style="color:#6272a4">/*
</span><span style="color:#6272a4">        Êèê‰∫§‰∫ãÂä°
</span><span style="color:#6272a4">     */</span>
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">commit</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
        Connection connection <span style="color:#ff79c6">=</span> connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
            connection<span style="color:#ff79c6">.</span><span style="color:#50fa7b">commit</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>SQLException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
            e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span>

    <span style="color:#ff79c6">}</span>

    <span style="color:#6272a4">/*
</span><span style="color:#6272a4">        ÂõûÊªö‰∫ãÂä°
</span><span style="color:#6272a4">     */</span>
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">rollback</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
        Connection connection <span style="color:#ff79c6">=</span> connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
            connection<span style="color:#ff79c6">.</span><span style="color:#50fa7b">rollback</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>SQLException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
            e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#6272a4">/*
</span><span style="color:#6272a4">        ÈáäÊîæËµÑÊ∫ê
</span><span style="color:#6272a4">     */</span>
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">release</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
        <span style="color:#6272a4">// Â∞ÜÊâãÂä®‰∫ãÂä°ÊîπÂõûÊàêËá™Âä®Êèê‰∫§‰∫ãÂä°
</span><span style="color:#6272a4"></span>        Connection connection <span style="color:#ff79c6">=</span> connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
            connection<span style="color:#ff79c6">.</span><span style="color:#50fa7b">setAutoCommit</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">true</span><span style="color:#ff79c6">);</span>
            <span style="color:#6272a4">// Â∞ÜËøûÊé•ÂΩíËøòÂà∞ËøûÊé•Ê±†
</span><span style="color:#6272a4"></span>            connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">close</span><span style="color:#ff79c6">();</span>
            <span style="color:#6272a4">// Ëß£Èô§Á∫øÁ®ãÁªëÂÆö
</span><span style="color:#6272a4"></span>            connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">removeThreadConnection</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>SQLException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
            e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></div><h4 id="ÊîπÈÄ†-servie-Âíå-dao">ÊîπÈÄ† Servie Âíå Dao</h4>
<ul>
<li>
<p>Service Â±Ç‰∏≠ËøõË°åÊâãÂä®ÂºÄÂêØ‰∫ãÂä°ÔºåÊó†ËØØÂàôÊâãÂä®Êèê‰∫§ÔºåÂºÇÂ∏∏ÂàôÂõûÊªö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">transfer</span><span style="color:#ff79c6">(</span>String outUser<span style="color:#ff79c6">,</span> String inUser<span style="color:#ff79c6">,</span> Double money<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        <span style="color:#6272a4">//ÊâãÂä®ÂºÄÂêØ‰∫ãÂä°
</span><span style="color:#6272a4"></span>        transactionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">beginTransaction</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
            accountDao<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">(</span>outUser<span style="color:#ff79c6">,</span>money<span style="color:#ff79c6">);</span>
            accountDao<span style="color:#ff79c6">.</span><span style="color:#50fa7b">in</span><span style="color:#ff79c6">(</span>inUser<span style="color:#ff79c6">,</span> money<span style="color:#ff79c6">);</span>
            <span style="color:#6272a4">//ÊâãÂä®Êèê‰∫§‰∫ãÂä°
</span><span style="color:#6272a4"></span>            transactionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">commit</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>Exception e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
            transactionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">rollback</span><span style="color:#ff79c6">();</span>
            e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">finally</span> <span style="color:#ff79c6">{</span>
            transactionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">release</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span>
</code></pre></div></li>
<li>
<p>Dao ÊñπÊ≥ï‰∏≠‰ΩøÁî® DBUtils Êó∂Ôºå‰º†ÂÖ•‰ªé ConnectionManager ‰∏≠Ëé∑ÂèñÁöÑ Connection</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">out</span><span style="color:#ff79c6">(</span>String outAccount<span style="color:#ff79c6">,</span> Double money<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        String sql <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;update account set money = money - ? where name = ?&#34;</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
            queryRunner<span style="color:#ff79c6">.</span><span style="color:#50fa7b">update</span><span style="color:#ff79c6">(</span>connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">(),</span> sql<span style="color:#ff79c6">,</span>money<span style="color:#ff79c6">,</span>outAccount<span style="color:#ff79c6">);</span>
        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>SQLException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
            e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">}</span>

    @Override
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">in</span><span style="color:#ff79c6">(</span>String inAccount<span style="color:#ff79c6">,</span> Double money<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        String sql <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;update account set money=money+? where name=?&#34;</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
         queryRunner<span style="color:#ff79c6">.</span><span style="color:#50fa7b">update</span><span style="color:#ff79c6">(</span>connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">(),</span>sql<span style="color:#ff79c6">,</span>money<span style="color:#ff79c6">,</span>inAccount<span style="color:#ff79c6">);</span>
        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>SQLException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
            e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">}</span>
</code></pre></div></li>
</ul>
<blockquote>
<p>ÈÄöËøá‰ª•‰∏äÁöÑÊîπÈÄ†ÔºåÂ∑≤ÁªèÂÆûÁé∞‰∫Ü‰∏öÂä°ÊéßÂà∂Ôºå‰ΩÜ‰πüÂºïÂÖ•‰∫ÜÊñ∞ÁöÑÈóÆÈ¢òÔºö</p>
</blockquote>
<p>‰∏öÂä°Â±ÇÊñπÊ≥ïÂèòÂæóËáÉËÇø‰∫ÜÔºå‰∏öÂä°ÈÄªËæëÂíå‰∫ãÂä°ÊéßÂà∂ÊñπÊ≥ïËÄ¶ÂêàÔºåÂ¶ÇÊûú‰∏öÂä°Â±ÇÊñπÊ≥ïË∂äÊù•Ë∂äÂ§öÔºåÂ∞ÜÂÖÖÊñ•ÁùÄÈáçÂ§çÁöÑ‰ª£Á†ÅÔºåËøùËÉå‰∫ÜÈù¢ÂêëÂØπË±°‰ΩéËÄ¶ÂêàÁöÑÂºÄÂèëÊÄùÊÉ≥</p>
<h3 id="proxy-Âä®ÊÄÅ‰ª£ÁêÜ‰ºòÂåñ">Proxy Âä®ÊÄÅ‰ª£ÁêÜ‰ºòÂåñ</h3>
<hr>
<p>ÊÄùË∑ØÔºöÂ∞Ü‰∏öÂä°‰ª£Á†ÅÂíå‰∫ãÂä°ÊéßÂà∂‰ª£Á†ÅÂàÜÁ¶ªÔºåÈÄöËøáÂä®ÊÄÅ‰ª£ÁêÜÁöÑÊñπÂºèÂØπ‰∏öÂä°ÊñπÊ≥ïËøõË°å‰∫ãÂä°Â¢ûÂº∫Ôºå‰ª•Èôç‰ΩéËÄ¶Âêà‰ªéËÄå‰∏çÂØπ‰∏öÂä°Â±Ç‰∫ßÁîüÂΩ±Âìç</p>
<h4 id="jdk-Âä®ÊÄÅ‰ª£ÁêÜ">JDK Âä®ÊÄÅ‰ª£ÁêÜ</h4>
<p>Âü∫‰∫éÊé•Âè£ÁöÑÂä®ÊÄÅ‰ª£ÁêÜÔºåË¢´‰ª£ÁêÜÁöÑÁ±ªÔºàÁõÆÊ†áÁ±ªÔºâÂøÖÈ°ªÂÆûÁé∞‰∏Ä‰∏™Êé•Âè£</p>
<p><img src="https://logseq.oss-cn-chengdu.aliyuncs.com/noteImg/202203122002207.png" alt=""></p>
<p>Âà©Áî®ÂÆûÁé∞ InvocationHandler Êé•Âè£ÁöÑÊã¶Êà™Âô®ÂíåÂèçÂ∞ÑÊú∫Âà∂ÔºåÁîüÊàê‰ª£ÁêÜÊé•Âè£ÁöÑÂåøÂêçÁ±ªÔºà‰ª£ÁêÜÂØπË±°ÔºâÔºåÂú®Ë∞ÉÁî®ÁõÆÊ†áÊñπÊ≥ïÂâçË∞ÉÁî® InvokeHander Êù•ÂÆûÁé∞ÊñπÊ≥ïÂ¢ûÂº∫</p>
<ul>
<li>
<p>JDKProxyFactoryÔºöÂä®ÊÄÅ‰ª£ÁêÜÂ∑•ÂéÇÁ±ªÔºåÂú®ËøîÂõûÁöÑÂä®ÊÄÅ‰ª£ÁêÜÂØπË±°‰∏≠ËøõË°å‰∫ãÂä°ÊéßÂà∂</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Component<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;proxyFactory&#34;</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">JDKProxyFactory</span> <span style="color:#ff79c6">{</span>
    <span style="color:#6272a4">/**
</span><span style="color:#6272a4">     * ÁõÆÊ†áÁ±ªÔºàË¢´‰ª£ÁêÜÂØπË±°Ôºâ
</span><span style="color:#6272a4">     * Âà©Áî®Êé•Âè£Êù•Êé•Êî∂
</span><span style="color:#6272a4">     */</span>
    @Autowired
    <span style="color:#8be9fd;font-style:italic">private</span> AccountService accountService<span style="color:#ff79c6">;</span>

    @Autowired
    <span style="color:#8be9fd;font-style:italic">private</span> TransactionManager transactionManager<span style="color:#ff79c6">;</span>

    <span style="color:#8be9fd;font-style:italic">public</span> AccountService <span style="color:#50fa7b">createAccountServiceJDKProxy</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
        AccountService accountServiceProxy <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
        accountServiceProxy <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>AccountService<span style="color:#ff79c6">)</span> Proxy<span style="color:#ff79c6">.</span><span style="color:#50fa7b">newProxyInstance</span><span style="color:#ff79c6">(</span>accountService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getClass</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">getClassLoader</span><span style="color:#ff79c6">(),</span>
                accountService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getClass</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">getInterfaces</span><span style="color:#ff79c6">(),</span><span style="color:#ff79c6">new</span> InvocationHandler<span style="color:#ff79c6">(){</span>

                    @Override
                    <span style="color:#8be9fd;font-style:italic">public</span> Object <span style="color:#50fa7b">invoke</span><span style="color:#ff79c6">(</span>Object proxy<span style="color:#ff79c6">,</span> Method method<span style="color:#ff79c6">,</span> Object<span style="color:#ff79c6">[]</span> args<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">throws</span> Throwable <span style="color:#ff79c6">{</span>
                        Object result <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
                        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
                            transactionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">beginTransaction</span><span style="color:#ff79c6">();</span>
                            result <span style="color:#ff79c6">=</span> method<span style="color:#ff79c6">.</span><span style="color:#50fa7b">invoke</span><span style="color:#ff79c6">(</span>accountService<span style="color:#ff79c6">,</span>args<span style="color:#ff79c6">);</span>
                            transactionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">commit</span><span style="color:#ff79c6">();</span>
                        <span style="color:#ff79c6">}</span><span style="color:#ff79c6">catch</span><span style="color:#ff79c6">(</span>InvocationTargetException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
                            e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
                            transactionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">rollback</span><span style="color:#ff79c6">();</span>
                        <span style="color:#ff79c6">}</span><span style="color:#ff79c6">finally</span> <span style="color:#ff79c6">{</span>
                            transactionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">release</span><span style="color:#ff79c6">();</span>
                        <span style="color:#ff79c6">}</span>
                        <span style="color:#ff79c6">return</span> result<span style="color:#ff79c6">;</span>
                    <span style="color:#ff79c6">}</span>
                <span style="color:#ff79c6">});</span>
        <span style="color:#ff79c6">return</span> accountServiceProxy<span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></div></li>
</ul>
<h4 id="cglib-Âä®ÊÄÅ‰ª£ÁêÜ">CGLIB Âä®ÊÄÅ‰ª£ÁêÜ</h4>
<p>Âü∫‰∫éÁà∂Á±ªÁöÑÂä®ÊÄÅ‰ª£ÁêÜÊäÄÊúØÔºåÊó†ÈúÄÂÆûÁé∞Êé•Âè£</p>
<p>Âú®ËøêË°åÊó∂Ôºå‰∏∫‰ª£ÁêÜÁ±ªÂä®ÊÄÅÁîüÊàêÂ≠êÁ±ªÔºåÈáçÂÜôË¢´‰ª£ÁêÜÁ±ªÊâÄÊúâÈùû final ÊñπÊ≥ï„ÄÇÂú®Â≠êÁ±ª‰∏≠‰ΩøÁî®ÊñπÊ≥ïÊã¶Êà™ÁöÑÊäÄÊúØÊã¶Êà™ÊâÄÊúâÊñπÊ≥ïË∞ÉÁî®ÔºåÊ§çÂÖ•Ê®™ÂàáÈÄªËæëÂØπÊñπÊ≥ïËøõË°åÂ¢ûÂº∫</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">CglibProxyFactory</span> <span style="color:#ff79c6">{</span>
    @Autowired
    <span style="color:#8be9fd;font-style:italic">private</span> AccountService accountService<span style="color:#ff79c6">;</span>
    @Autowired
    <span style="color:#8be9fd;font-style:italic">private</span> TransactionManager transactionManager<span style="color:#ff79c6">;</span>

    <span style="color:#8be9fd;font-style:italic">public</span> AccountService <span style="color:#50fa7b">createAccountServiceCglibProxy</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
        AccountService accountServiceProxy <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
        accountServiceProxy <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>AccountService<span style="color:#ff79c6">)</span>
          Enhancer<span style="color:#ff79c6">.</span><span style="color:#50fa7b">create</span><span style="color:#ff79c6">(</span>accountService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getClass</span><span style="color:#ff79c6">(),</span> <span style="color:#ff79c6">new</span> MethodInterceptor<span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
              @Override
              <span style="color:#8be9fd;font-style:italic">public</span> Object <span style="color:#50fa7b">intercept</span><span style="color:#ff79c6">(</span>Object o<span style="color:#ff79c6">,</span> Method method<span style="color:#ff79c6">,</span> Object<span style="color:#ff79c6">[]</span> objects<span style="color:#ff79c6">,</span> MethodProxy methodProxy<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">throws</span> Throwable <span style="color:#ff79c6">{</span>
                  Object result <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
                  <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
                      <span style="color:#6272a4">// 1.ÂºÄÂêØ‰∫ãÂä°
</span><span style="color:#6272a4"></span>                      transactionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">beginTransaction</span><span style="color:#ff79c6">();</span>
                      <span style="color:#6272a4">// 2.‰∏öÂä°Êìç‰Ωú
</span><span style="color:#6272a4"></span>                      result <span style="color:#ff79c6">=</span> method<span style="color:#ff79c6">.</span><span style="color:#50fa7b">invoke</span><span style="color:#ff79c6">(</span>accountService<span style="color:#ff79c6">,</span> objects<span style="color:#ff79c6">);</span>
                      <span style="color:#6272a4">// 3.Êèê‰∫§‰∫ãÂä°
</span><span style="color:#6272a4"></span>                      transactionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">commit</span><span style="color:#ff79c6">();</span>
                  <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>Exception e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
                      e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
                      <span style="color:#6272a4">// 4.ÂõûÊªö‰∫ãÂä°
</span><span style="color:#6272a4"></span>                      transactionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">rollback</span><span style="color:#ff79c6">();</span>
                  <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">finally</span> <span style="color:#ff79c6">{</span>
                      <span style="color:#6272a4">// 5.ÈáäÊîæËµÑÊ∫ê
</span><span style="color:#6272a4"></span>                      transactionManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">release</span><span style="color:#ff79c6">();</span>
                  <span style="color:#ff79c6">}</span>
                  <span style="color:#ff79c6">return</span> result<span style="color:#ff79c6">;</span>
              <span style="color:#ff79c6">}</span>
          <span style="color:#ff79c6">});</span>
        <span style="color:#ff79c6">return</span> accountServiceProxy<span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></div><h3 id="aop-‰ºòÂåñ">AOP ‰ºòÂåñ</h3>
<p>ÈÖçÁΩÆÂàáÁÇπÂíåÂàáÈù¢</p>
<ul>
<li>XML Ê†ºÂºèÁöÑÂü∫Êú¨ÈÄöÁü•Á±ªÂûã</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">    <span style="color:#ff79c6">&lt;aop:config&gt;</span>
<span style="color:#6272a4">&lt;!--        ÂàáÁÇπË°®ËææÂºè--&gt;</span>
        <span style="color:#ff79c6">&lt;aop:pointcut</span> <span style="color:#50fa7b">id=</span><span style="color:#f1fa8c">&#34;myPt&#34;</span> <span style="color:#50fa7b">expression=</span><span style="color:#f1fa8c">&#34;execution(* xyz.wvuuvw.service.impl.AccountServiceImpl.*(..))&#34;</span><span style="color:#ff79c6">/&gt;</span>
<span style="color:#6272a4">&lt;!--        ÂàáÈù¢ÈÖçÁΩÆ--&gt;</span>
        <span style="color:#ff79c6">&lt;aop:aspect</span> <span style="color:#50fa7b">ref=</span><span style="color:#f1fa8c">&#34;transactionManager&#34;</span><span style="color:#ff79c6">&gt;</span>
            <span style="color:#ff79c6">&lt;aop:before</span> <span style="color:#50fa7b">method=</span><span style="color:#f1fa8c">&#34;beginTransaction&#34;</span> <span style="color:#50fa7b">pointcut-ref =</span> <span style="color:#f1fa8c">&#34;myPt&#34;</span><span style="color:#ff79c6">/&gt;</span>
            <span style="color:#ff79c6">&lt;aop:after-returning</span> <span style="color:#50fa7b">method=</span><span style="color:#f1fa8c">&#34;commit&#34;</span> <span style="color:#50fa7b">pointcut-ref =</span> <span style="color:#f1fa8c">&#34;myPt&#34;</span><span style="color:#ff79c6">/&gt;</span>
            <span style="color:#ff79c6">&lt;aop:after-throwing</span> <span style="color:#50fa7b">method=</span><span style="color:#f1fa8c">&#34;rollback&#34;</span> <span style="color:#50fa7b">pointcut-ref =</span> <span style="color:#f1fa8c">&#34;myPt&#34;</span><span style="color:#ff79c6">/&gt;</span>
            <span style="color:#ff79c6">&lt;aop:after</span> <span style="color:#50fa7b">method=</span><span style="color:#f1fa8c">&#34;release&#34;</span> <span style="color:#50fa7b">pointcut-ref =</span> <span style="color:#f1fa8c">&#34;myPt&#34;</span><span style="color:#ff79c6">/&gt;</span>
        <span style="color:#ff79c6">&lt;/aop:aspect&gt;</span>
    <span style="color:#ff79c6">&lt;/aop:config&gt;</span>
</code></pre></div><ul>
<li>Ê≥®Ëß£ÂΩ¢ÂºèÁöÑÁéØÁªïÈÄöÁü•</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Component<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;transactionManager&#34;</span><span style="color:#ff79c6">)</span>
@Aspect <span style="color:#6272a4">//Ë°®ÊòéËØ•Á±ª‰∏∫ÂàáÈù¢Á±ª
</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">TransactionManager</span> <span style="color:#ff79c6">{</span>

    @Autowired
    <span style="color:#8be9fd;font-style:italic">private</span> ConnectionUtils connectionUtils<span style="color:#ff79c6">;</span>


    @Around<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;execution(* xyz.wvuuvw.service.impl.AccountServiceImpl.*(..))&#34;</span><span style="color:#ff79c6">)</span>
    <span style="color:#8be9fd;font-style:italic">public</span> Object <span style="color:#50fa7b">around</span><span style="color:#ff79c6">(</span>ProceedingJoinPoint pjp<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">throws</span> SQLException <span style="color:#ff79c6">{</span>

        Object proceed <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
            <span style="color:#6272a4">// ÂºÄÂêØÊâãÂä®‰∫ãÂä°
</span><span style="color:#6272a4"></span>            connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">setAutoCommit</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">false</span><span style="color:#ff79c6">);</span>
            <span style="color:#6272a4">// ÂàáÂÖ•ÁÇπÊñπÊ≥ïÊâßË°å
</span><span style="color:#6272a4"></span>            proceed <span style="color:#ff79c6">=</span> pjp<span style="color:#ff79c6">.</span><span style="color:#50fa7b">proceed</span><span style="color:#ff79c6">();</span>

            <span style="color:#6272a4">// ÊâãÂä®Êèê‰∫§‰∫ãÂä°
</span><span style="color:#6272a4"></span>            connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">commit</span><span style="color:#ff79c6">();</span>

        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>Throwable throwable<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
            throwable<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">();</span>
            <span style="color:#6272a4">// ÊâãÂä®ÂõûÊªö‰∫ãÂä°
</span><span style="color:#6272a4"></span>            connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">rollback</span><span style="color:#ff79c6">();</span>

        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">finally</span> <span style="color:#ff79c6">{</span>
            <span style="color:#6272a4">// Â∞ÜÊâãÂä®‰∫ãÂä°ÊÅ¢Â§çÊàêËá™Âä®‰∫ãÂä°
</span><span style="color:#6272a4"></span>            connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">setAutoCommit</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">true</span><span style="color:#ff79c6">);</span>
            <span style="color:#6272a4">// Â∞ÜËøûÊé•ÂΩíËøòÂà∞ËøûÊé•Ê±†
</span><span style="color:#6272a4"></span>            connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getThreadConnection</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">close</span><span style="color:#ff79c6">();</span>
            <span style="color:#6272a4">// Ëß£Èô§Á∫øÁ®ãÁªëÂÆö
</span><span style="color:#6272a4"></span>            connectionUtils<span style="color:#ff79c6">.</span><span style="color:#50fa7b">removeThreadConnection</span><span style="color:#ff79c6">();</span>
        <span style="color:#ff79c6">}</span>
        <span style="color:#ff79c6">return</span>  proceed<span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
  <span style="color:#ff79c6">....</span>
</code></pre></div>
                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">ÊúÄÂêé‰øÆÊîπ‰∫é 2021-01-03</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://blog.wvuuvw.xyz/posts/%E7%BB%8F%E5%85%B8%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1/">
			‰∏ä‰∏ÄÁØá<br>ÁªèÂÖ∏ÁºìÂ≠òËÆæËÆ°ÊÄùË∑Ø
                </a>
                
                
                
                <a class="older-posts" href="https://blog.wvuuvw.xyz/posts/redis%E7%BC%93%E5%AD%98%E6%A1%88%E4%BE%8B/">
			‰∏ã‰∏ÄÁØá<br>RedisÁºìÂ≠òËÆæËÆ°Ê°à‰æã
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                










            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Powered by <a href="https://github.com/gohugoio/hugo">hugo</a>
<br>

&copy;
	
	2022 ZackYJ&#39;s Blog
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
